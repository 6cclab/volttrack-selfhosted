# ==========================================
# VoltTrack Self-Hosted Configuration
# ==========================================
# Copy this file to .env and configure for your deployment
# IMPORTANT: Generate secure random values for all secrets!

# ==========================================
# General Configuration
# ==========================================
# Environment: dev (develop branch images) or prd (main branch images)
VOLTTRACK_ENV=dev

# Node environment
NODE_ENV=production

# Enable pretty-printed logs (0 for JSON, 1 for human-readable)
PRETTY_PRINT=0

# ==========================================
# Database Configuration (PostgreSQL/TimescaleDB)
# ==========================================
POSTGRES_USER=volttrack
POSTGRES_PASSWORD=CHANGE_THIS_TO_SECURE_PASSWORD
POSTGRES_DB=volttrack
POSTGRES_PORT=5432

# ==========================================
# Redis Configuration
# ==========================================
REDIS_PORT=6379
REDIS_INSIGHT_PORT=8001

# ==========================================
# Authentication (Better Auth)
# ==========================================
# CRITICAL: Generate a secure random secret (min 32 characters)
# Example: openssl rand -base64 32
BETTER_AUTH_SECRET=CHANGE_THIS_TO_SECURE_RANDOM_STRING

# Base URL where your VoltTrack instance will be accessible
# Examples:
#   - http://localhost (local development)
#   - https://volttrack.yourdomain.com (production with reverse proxy)
BETTER_AUTH_URL=http://localhost

# ==========================================
# CORS & Security Configuration
# ==========================================
# Cookie domain (leave empty for localhost, or set to your domain)
# Example: .yourdomain.com (note the leading dot for subdomains)
COOKIE_DOMAIN=

# Trusted origins for CORS (JSON array format)
# Example: https://volttrack.yourdomain.com,https://www.yourdomain.com
TRUSTED_ORIGINS=http://localhost:3000

# CORS configuration (JSON format)
# Adjust origins to match your deployment URLs
CORS_CONFIG={"origin": ["http://localhost:3000"], "credentials": true, "exposeHeaders": ["set-cookie"]}

# ==========================================
# Service URLs (Internal Communication)
# ==========================================
# These are Docker internal URLs - do not change unless customizing
AUTH_SERVICE_URL=http://auth:3002

# ==========================================
# Client URLs (External Access)
# ==========================================
# Public URLs where services are accessible
# Update these to match your reverse proxy or public URLs

# WebSocket URL for real-time communication
# Examples:
#   - ws://localhost:3003/ws (local without SSL)
#   - wss://ws.yourdomain.com/ws (production with SSL)
WEBSOCKET_URL=ws://localhost:3003/ws
SOCKET_URL=ws://localhost:3003/ws

# API URLs
# Examples:
#   - http://localhost:3001 (local)
#   - https://api.yourdomain.com (production)
API_URL=http://localhost:3001
API_V2_URL=http://localhost:3001

# ==========================================
# Application Ports
# ==========================================
# External ports where services are exposed
CLIENT_PORT=3000
API_PORT=3001
AUTH_PORT=3002
WEBSOCKET_PORT=3003
EVENT_BUS_PORT=3004

# ==========================================
# S3 Storage Configuration
# ==========================================
# Option 1: Use included Garage S3 (recommended for simple deployments)
#   - Start with: docker compose --profile s3 up
#   - Garage will auto-configure on first run
#
# Option 2: Use external S3-compatible service (AWS S3, MinIO, etc.)
#   - Configure your S3 credentials below
#   - Do NOT use --profile s3 when starting

# S3 Endpoint
# - For Garage: http://garage:3900
# - For AWS S3: https://s3.amazonaws.com
# - For MinIO: http://minio:9000
S3_ENDPOINT=http://garage:3900

# S3 Credentials
# Note: If using Garage with auto-config, these will be generated automatically
# Check the garage-init container logs for the generated credentials
AWS_ACCESS_KEY_ID=GK_volttrack
AWS_SECRET_ACCESS_KEY=CHANGE_THIS_OR_USE_GARAGE_GENERATED

# S3 Bucket name for storing reports
AWS_BUCKET=volttrack-reports

# S3 Region
# - For Garage: garage (default)
# - For AWS: us-east-1, eu-west-1, etc.
AWS_REGION=garage

# Force path-style URLs (required for Garage and MinIO)
FORCE_PATH_STYLE=true

# Garage RPC Secret (only needed if using Garage)
# Generate with: openssl rand -base64 32
GARAGE_RPC_SECRET=CHANGE_THIS_TO_SECURE_RANDOM_STRING

# Garage Ports (only needed if using Garage)
GARAGE_S3_PORT=3900
GARAGE_WEB_PORT=3902

# ==========================================
# API Keys
# ==========================================
# Mapbox API Key for map visualization
# Get one at: https://www.mapbox.com/
MAPBOX_KEY=YOUR_MAPBOX_API_KEY_HERE

# ==========================================
# Notes
# ==========================================
# 1. Security Best Practices:
#    - Always use strong, unique passwords and secrets
#    - Never commit .env files to version control
#    - Rotate credentials regularly in production
#
# 2. Production Deployment:
#    - Use a reverse proxy (nginx, Traefik, Caddy) for SSL/TLS
#    - Set proper CORS origins to match your domain
#    - Configure firewall rules to restrict access
#    - Consider using Docker secrets for sensitive data
#
# 3. Garage vs External S3:
#    - Garage: Simple, self-hosted, auto-configured
#    - External S3: More scalable, managed service
#    Choose based on your requirements and infrastructure
#
# 4. Getting Started:
#    - Copy this file to .env
#    - Update all CHANGE_THIS values
#    - Configure your public URLs (BETTER_AUTH_URL, WEBSOCKET_URL, API_URL)
#    - Run: docker compose up -d (without S3)
#    - Or: docker compose --profile s3 up -d (with Garage)
